\chapter{Description du Sujet et Gestion de Stage}
\label{chap:sujet}
\OnehalfSpacing

\section{Description du Sujet de Stage}
\label{sec:sujet}

Le laboratoire TIMA développe un mécanisme de sélection des points
d'arrêts de l'exécution d'un traitement sur un FPGA. L'idée sous-jacente
est de pouvoir arrêter une tâche sur un FPGA et de transférer la suite de
l'exécution sur un autre FPGA.
Ce mécanisme est connu sur le système à base de CPU 
en tant que \emph{context switch} ou "commutation de contexte".
Un contexte sur FPGA est définie comme une image de l'état des circuits configurés dans le FPGA.

La commutation de contexte en informatique consiste à sauvegarder
l'état d'un processus pour restaurer à la place d'un autre dans le cadre de l'ordonnancement 
d'un système d'exploitation. La commutation de contexte sur FPGA (cf. Section \ref{sec:contextswitch}) 
effectue un traitement similaire sur des circuits logiques au lieu d'un système d'exploitation. 
Elle est possible grâce aux blocs logiques programmables
qui construisent la plateforme FPGA.

Dans le cadre de sa thèse au laboratoire TIMA, M. Alban Bourge a proposé une méthode de la commutation 
de contexte sur FPGA par l'extraction de l'image de l'état sur certains points de contrôle\cite{Bourge2015}. 
Un algorithme a été ajouté à chaque IP\footnote{\emph{Intelectual Property}, dans ce contexte est le circuit programmé sur FPGA} synthétisé
afin de choisir le meilleur point de contrôle selon les contraintes donnés par l'utilisateur.
Lors de la synthèse logique, l'IP est modifié afin qu'il puisse effectuer la commutation de contexte.

La réalisation de cette méthode a été faite par une méthode intégrée dans un outil de synthèse de haut niveau.
Ceci est réalisable grâce à un outil de synthèse logique de haut-niveau AUGH\cite{Prost2014} 
qui a été développé par un chercheur postdoctoral au laboratoire TIMA.
Le AUGH est capable de générer des IP 
depuis un programme écrit en langage C. L'intégration de la méthode proposée par M. Alban Bourge sur AUGH 
nous permet de générer un IP qui supporte les récupérations et restaurations de contexte sur FPGA.

Pendant le projet 3i5, une plateforme a été construite pour valider des IP générés par AUGH automatiquement\cite{Brisebard2015}.
Cette plateforme de validation consiste à un environnement de pilotage et une carte ZYBO\cite{zyboweb}
connecté à un serveur qui contient un outil de back-end Xilinx. L'environnement de pilotage permet d'envoyer les
vecteurs d'entrées, de recevoir les sorties et de les comparer avec la référence.
Les interfaces entrées-sorties personnalisées sont ajoutées dans l'architecture pour transférer des données entrées-sorties.
Cette plateforme est assez puissante pour construire un architecture à partir d'un IP généré par AUGH
avec les interfaces automatiquement.

En adaptant de l'idée de la validation automatique du projet 3i5 au stage, une plateforme pour valider et évaluer les performances du mécanisme
de la commutation de contexte est proposée. La plateforme est composé d'une ZYBO connecté au réseau et d'un environnement de pilotage.
Comme le mécanisme de la commutation de contexte est intégré dans l'IP généré par AUGH,
le principe de génération d'architecture est similaire et les interfaces entrées-sorties peuvent être réutilisées avec quelques 
modifications. L'environnement de pilotage permet de
synthétiser les IP, de commander l'arrêt de l'exécution d'un IP, de récupérer du contexte, de transférer du contexte et
de reprendre l'exécution.

\section{Gestion de Stage}
\label{sec:gestion}
\justify
Afin d'augmenter l'efficacité du travail et d'atteindre le but de stage, un planning a été fait.
Ce planning est présenté en diagramme de gantt dans la Figure \ref{fig:gantt} et en diagramme de PERT
dans la Figure \ref{fig:pert}.

Dans la Figure \ref{fig:gantt}, le stage est divisée en quatre grandes parties. La première partie est le développement matériel. Cette partie concerne
de l'intégration de l'IP et ses interfaces. La deuxième partie est le développement de logiciel. Ce développement
concerne le système d'exploitation, les logiciels qui seront embarqué et les scripts pour lancer le flot d'exécution.
La troisième partie de stage est le test. Dans tous les développements de système, les tests sont nécessaires
pour valider les composants (test unitaire) et l'intégration de tous les composants (test d'intégration). La dernière partie
est la documentation de stage. Cette documentation inclut la rédaction du rapport et la préparation de soutenance.

Les premières deux semaines ont été consacrées pour modifier les interfaces E/S personnalisées. Ces interfaces
gèrent les entrées et les sorties de l'IP généré par AUGH. Pour valider la commutation de contexte,
il faudrait s'assurer que l'application fonctionne correctement incluant les communications d'entrées-sorties.
Dans le projet 3i5, les interfaces similaires sont utilisées, il suffit de faire une petite amélioration sur le mécanisme de protocole
\emph{handshake} qui sera expliquée dans la Section \ref{sec:concephard}.

Après les interfaces E/S sont finies et testées, le stage s'avance au développement de l'interface de la commutation
de contexte pendant environ un mois. Afin d'évaluer les performances de système, l'utilisateur doit avoir un accès au
nombre des cycles passés pendant l'exécution, un timer est donc développé pendant deux semaines pour enregistrer
le nombre des cycles de l'exécution et de la commutation de contexte.

La partie logicielle est développée pendant 6 semaines, incluant les programmes pour l'envoi de l'E/S, la commutation
de contexte et enregistrement/chargement de cycles. 

Dans le stage, les tests sont effectués pour chaque composant et programme construisent ainsi que ses intégrations. 
Le test unitaire est réalisé en faisant les simulations fonctionnelles pour la partie matérielle et les compilations en GCC
pour les programmes qui seront embarqués au système d'exploitation. Après tous les composants sont intégrés,
le test global/intégration est effectué en même temps que le développement de script de l'exécution au serveur
et à la plateforme. 

Un mois et demi restant étant prévu pour le rédaction du rapport qui superpose le test d'intégration et la préparation
de soutenance.

\begin{figure}[h]
	\centering
	\includegraphics[width=0.9\textheight,angle=90]{stage2}
	\caption{La diagramme de gantt de déroulement du stage}
	\label{fig:gantt}
	\vspace{-2mm}
\end{figure}

Les dépendances entre les tâches sont présentées dans la Figure \ref{fig:pert}. Le chemin critique est montré par le noyau
de test unitaire et le noyau de test global. Ce sont des tâches qui sont les plus importantes et qui durent les plus longues car
elles valident les travails effectués dans le stage. La durée de test unitaire est prévu comme la durée de développement
matériel additionné par la durée de développement logiciel s'ils sont fait en séquence.

\begin{figure}[h]
	\centering
	\includegraphics[width=0.9\textheight, angle=90]{pert}
	\caption{La diagramme des tâches (méthode PERT) du stage}
	\label{fig:pert}
	\vspace{-2mm}
\end{figure}

